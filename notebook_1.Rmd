---
title: "R Notebook"
output: html_notebook
---

```{r}
# install libraries
library(tidyverse)

# Install libraries for mapping purposes
library(tigris)
library(leaflet)
library(maps)
```
```{r}
tot_pop_df <- read_csv("5Y2016_S0101.csv", n_max = 1)
head(tot_pop_df)
```

```{r}
tot_pop_edited <- tot_pop_df %>%
  rename(
    "Miami-Dade" = "Miami-Dade County, Florida!!Total!!Estimate",
    "Broward" = "Broward County, Florida!!Total!!Estimate",
    "Palm Beach" = "Palm Beach County, Florida!!Total!!Estimate",
    "Monroe" = "Monroe County, Florida!!Total!!Estimate"
  )
tot_pop_edited
```
```{r}
tgt_counties <- c("Miami-Dade", "Broward", "Palm Beach", "Monroe")
tot_pop_tgts <- tot_pop_edited %>% select(tgt_counties)
head(tot_pop_tgts)
```


```{r}
commute_time <- read_csv("commuteTime45_2012_16.csv")
commute_time
```
```{r}
#
filter_tgt_counties <- function(df) {
  return(df %>% filter(
    County %in% tgt_counties
  ))
}
```


```{r}
#
commute_time_tgts <- filter_tgt_counties(commute_time)
commute_time_tgts
```


```{r}
tot_pop_tgts <- tot_pop_tgts[, order(names(tot_pop_tgts))]
tot_pop_tgts
```


```{r}
# Function to Calculate percent values
calc_percent <- function(df) {
  return(t(t(df[, "Value"]) / as.vector(unlist(tot_pop_tgts[1, ]))))
}
```


```{r}
#
perc_commuters <- calc_percent(commute_time_tgts)
perc_commuters
```
```{r}
# Sanity Check
132304 / 1863780
```
```{r}
commRate <- data.frame(County = tgt_counties, Rate = perc_commuters)
commRate
```


```{r}
heart_attack <- read_csv("heartAttackER_2012_16.csv")
heart_attack
```
```{r}
heart_attack_tgts <- filter_tgt_counties(heart_attack)
heart_attack_tgts
```
```{r}
heart_attack_tgts_mean <- heart_attack_tgts %>%
  group_by(County) %>%
  summarise(mean(Value))

heart_attack_tgts_mean
```
```{r}
#
heart_attack_tgts_mean <- heart_attack_tgts_mean %>%
  rename(
    "Value" = "mean(Value)"
  )
names(heart_attack_tgts_mean)
```

```{r}
perc_heart_attacks <- calc_percent(heart_attack_tgts_mean)
perc_heart_attacks
```

```{r}
hospRate <- data.frame(County = tgt_counties, Rate = perc_heart_attacks)
hospRate
```
```{r}
rate_data <- data.frame(County = hospRate[, 1], hospRate = hospRate[, 2], commRate = commRate[, 2])
rate_data
```

```{r}
# 3.1 Get mean value hospRate for all FL counties
all_heart_attack_mean_5yr <- heart_attack %>%
  group_by(County) %>%
  summarise(mean(Value))

all_heart_attack_mean_5yr <- all_heart_attack_mean_5yr %>%
  rename(
    "Value" = "mean(Value)"
  )
all_heart_attack_mean_5yr
```

```{r}
all_commRate_hospRate <- merge(all_heart_attack_mean_5yr, commute_time, by = "County")

all_commRate_hospRate <- all_commRate_hospRate %>%
  rename(
    "num_hsptlzd" = "Value.x",
    "num_commuters" = "Value.y"
  )

all_commRate_hospRate
```


```{r}
ggplot(all_commRate_hospRate, aes(x = num_commuters, y = num_hsptlzd)) +
  geom_point()
# theme(legend.position = "bottom")
```

```{r}
# Number of People Who Commute 45+ Minutes vs. Hospitalization from Heart Attack
```
### From the scatter plot above we can infere that there is a positive correlation with the number of people who commute over 45 minutes and number of heart attack related hospitalizations.
```{r}
# 4.1
# Calculate the ratio of heart attack hospitalizations by number of people who commute 45+ minutes for all Florida counties
hospRate_by_commRate <- all_commRate_hospRate %>%
  group_by(County) %>%
  summarise(num_hsptlzd / num_commuters)
hospRate_by_commRate
```

```{r}
# Sanity check
# Alachua
342.4 / 6408
```


